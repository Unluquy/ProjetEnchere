
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
</head>
<body>
<!--
    <div class="topnav" id="myTopnav">
        <a href="#home" class="active">ENI-Enchères</a>
      <a href="#news">S'inscrire</a>
        <a href="#">Se connecter</a>
        
        <h1>Liste des enchères</h1>
        <a href="javascript:void(0);" class="icon" onclick="myFunction()">
          <i class="fa fa-bars"></i>
        </a>
      </div>
-->

      <div class="container">
        <form method="get">
          <fieldset>    
            <div class="input-group">
              <div class="input-group-prepend">
                <select id="oCategorie" name="CategorieFiltre" class="custom-select  color text-white">
                    <c:if test="${!empty categories }">
                        <c:forEach var="l" items="${categories }">
                            <option name="${l.noCategorie}" ${sessionScope.categorieSelected == l.libelle ? 'selected="selected"' : ""}>${l.libelle}</option>
                        </c:forEach>
                    </c:if>
                    <c:if test="${empty categories}">
                        <h3>Pas de listes</h3>
                    </c:if>
                </select>
              </div>
              <input id="oSaisie" name="oSaisie" type="text" class="form-control" aria-label="Saisie de mots clés" placeholder="Mot(s) clé(s)">
              <div class="input-group-append">
                <button class="btn color" type="submit" name="submitFilter">Recherche</button>
              </div>
            </div>
          </fieldset>

            <div class="containerCheck">

                <div class="check">
                    <div class="form-check">
                        <%
                        if(session.getAttribute("radioAchats") != null){
                        %>
                            <script  type = "text/javascript" >
                                window.onload = function() {
                                    check();
                            };</script>
                            <input onclick="check()" class="form-check-input" type="radio" name="radioFiltre" value="radioAchats" id="flexRadioAchats" checked>
                        <%} else {%>
                            <input onclick="check()" class="form-check-input" type="radio" name="radioFiltre" value="radioAchats" id="flexRadioAchats">
                        <%} %>

                        <label class="form-check-label" for="flexRadioAchats">
                            Achats
                        </label>
                    </div>

                    <!-- Checked checkbox -->
                    <div class="form-check">
                        <%
                            if(session.getAttribute("EncheresOuvertes") != null){
                        %>
                            <input class="form-check-input" type="checkbox" value="EncheresOuvertes" name="CheckEncheres" id="CheckEncheresOuvertes" checked/>
                        <%} else {%>
                            <input class="form-check-input" type="checkbox" value="EncheresOuvertes" name="CheckEncheres" id="CheckEncheresOuvertes"/>
                        <%} %>
                        <label class="form-check-label" for="CheckEncheresOuvertes">enchères ouvertes</label>
                    </div>
                    <!-- Default checkbox -->
                    <div class="form-check">
                        <%
                        if(session.getAttribute("EncheresEnCours") != null){
                        %>
                            <input class="form-check-input" type="checkbox" value="EncheresEnCours" name="CheckEncheres" id="CheckEncheresEnCours" checked/>
                        <%} else {%>
                            <input class="form-check-input" type="checkbox" value="EncheresEnCours" name="CheckEncheres" id="CheckEncheresEnCours"/>
                        <%} %>
                        <label class="form-check-label" for="CheckEncheresEnCours">mes enchères en cours</label>
                    </div>
                    <!-- Default checkbox -->
                    <div class="form-check">
                        <%
                        if(session.getAttribute("EncheresRemportees") != null){
                        %>
                            <input class="form-check-input" type="checkbox" value="EncheresRemportees" name="CheckEncheres" id="CheckEncheresRemportees" checked/>
                        <%} else {%>
                            <input class="form-check-input" type="checkbox" value="EncheresRemportees" name="CheckEncheres" id="CheckEncheresRemportees" />
                        <%} %>
                        <label class="form-check-label" for="CheckEncheresRemportees">mes enchères remportées </label>
                    </div>

                </div>
<!-- * VENTES -->
                <div class="check">
                    <div class="form-check">
                        <%
                        if(session.getAttribute("radioVentes") != null){
                        %>
                            <script  type = "text/javascript" >
                                window.onload = function() {
                                    checkBoxVente();
                            };</script>
                            <input onclick="checkBoxVente()" class="form-check-input" type="radio" name="radioFiltre" value="radioVentes" id="flexRadioVentes" checked>
                        <%} else {%>
                            <input onclick="checkBoxVente()" class="form-check-input" type="radio" name="radioFiltre" value="radioVentes" id="flexRadioVentes">
                        <%} %>

                        <label class="form-check-label" for="flexRadioVentes">
                            Mes ventes
                        </label>
                    </div>

                    <!-- Default checkbox -->
                    <div class="form-check">
                        <%
                        if(session.getAttribute("VentesEnCours") != null){
                        %>
                            <input class="form-check-input" type="checkbox" value="VentesEnCours" name="CheckVentes" id="CheckVentesEnCours" checked/>
                        <%} else {%>
                            <input class="form-check-input" type="checkbox" value="VentesEnCours" name="CheckVentes" id="CheckVentesEnCours" />
                        <%} %>
                        <label class="form-check-label" for="CheckVentesEnCours">mes ventes en cours</label>
                    </div>

                    <!-- Default checkbox -->
                    <div class="form-check">
                        <%
                        if(session.getAttribute("VentesNonDebutees") != null){
                        %>
                            <input class="form-check-input" type="checkbox" value="VentesNonDebutees" name="CheckVentes" id="CheckVentesNonDebutees" checked/>
                        <%} else {%>
                            <input class="form-check-input" type="checkbox" value="VentesNonDebutees" name="CheckVentes" id="CheckVentesNonDebutees" />
                        <%} %>

                        <label class="form-check-label" for="CheckVentesNonDebutees">ventes non débutées </label>
                    </div>
                    <!-- Default checkbox -->
                    <div class="form-check">
                        <%
                        if(session.getAttribute("VentesTerminees") != null){
                        %>
                            <input class="form-check-input" type="checkbox" value="VentesTerminees" name="CheckVentes" id="CheckVentesTerminees" checked/>
                        <%} else {%>
                            <input class="form-check-input" type="checkbox" value="VentesTerminees" name="CheckVentes" id="CheckVentesTerminees" />
                        <%} %>

                        <label class="form-check-label" for="CheckVentesTerminees">ventes terminées </label>
                    </div>
                </div>
            </div>
        </form>
      </div>




 <div class="containerCard">

    <c:choose>
        <c:when test="${sessionScope.radioAchats != null}">

            <c:choose>
                <c:when test="${!empty articlesList && !empty enchereList}">
                    <c:forEach var="e" items="${enchereList }">
                        <c:forEach var="l" items="${articlesList }">
                            <c:if test="${(e.article.noArticle == l.noArticle || sessionScope.EncheresOuvertes != null) &&
                                 (
                                 (sessionScope.EncheresOuvertes   != null && l.dateFinEncheres.compareTo(sessionScope.dateNow) > 0 && l.dateDebutEncheres.compareTo(sessionScope.dateNow) <= 0 ) ||
                                 (sessionScope.EncheresEnCours    != null && l.dateDebutEncheres.compareTo(sessionScope.dateNow) <= 0 && l.dateFinEncheres.compareTo(sessionScope.dateNow) > 0 && e.user.pseudo == sessionScope.pseudoUser) ||
                                 (sessionScope.EncheresRemportees != null && l.dateFinEncheres.compareTo(sessionScope.dateNow) <= 0 && e.user.pseudo == sessionScope.pseudoUser)
                                 )
                                 }">
                                <div class="card" style="width: 18rem;">
                                    <img src="${pageContext.request.contextPath }${photoArticle}" class="card-img-top" alt="...">
                                    <div class="card-body">
                                        <a href="${pageContext.request.contextPath}/detailVente?id=${l.noArticle}" class="card-title">Nom : ${l.nomArticle}</a>
                                        <p class="card-text">Prix : ${l.prixInitial}</p>
                                        <p class="card-text">Fin de l'enchère : ${l.dateFinEncheres}</p>
                                        <p class="card-text">Vendeur :  ${l.user.pseudo}</p>
                                    </div>
                                </div>
                            </c:if>
                        </c:forEach>
                    </c:forEach>
                </c:when>
                <c:otherwise>
                    <c:if test="${!empty articlesList}">
                        <c:forEach var="l" items="${articlesList }">
                            <c:if test="${(sessionScope.EncheresOuvertes != null) &&
                                 (
                                 (sessionScope.EncheresOuvertes != null && l.dateFinEncheres.compareTo(sessionScope.dateNow) >= 0 && l.dateDebutEncheres.compareTo(sessionScope.dateNow) < 0 ) ||
                                 (sessionScope.EncheresOuvertes == null && sessionScope.EncheresEnCours == null && sessionScope.EncheresRemportees == null )
                                 )
                                 }">
                                <div class="card" style="width: 18rem;">
                                    <img src="${pageContext.request.contextPath }${photoArticle}" class="card-img-top" alt="...">
                                    <div class="card-body">
                                        <a href="${pageContext.request.contextPath}/detailVente?id=${l.noArticle}" class="card-title">Nom : ${l.nomArticle}</a>
                                        <p class="card-text">Prix : ${l.prixInitial}</p>
                                        <p class="card-text">Fin de l'enchère : ${l.dateFinEncheres}</p>
                                        <p class="card-text">Vendeur :  ${l.user.pseudo}</p>
                                    </div>
                                </div>
                            </c:if>
                        </c:forEach>
                    </c:if>
                </c:otherwise>
            </c:choose>
            <c:if test="${empty articlesList}">
                <h3>Pas d'encheres en cours</h3>
            </c:if>

        </c:when>

        <c:otherwise>
            <c:if test="${!empty articlesList && sessionScope.pseudoUser != null}">
                <c:forEach var="l" items="${articlesList }">
                    <!--TODO Categories tri-->
                    <c:if test="${l.user.pseudo == sessionScope.pseudoUser &&
                                 (
                                 (sessionScope.VentesEnCours        != null && l.dateFinEncheres.compareTo(sessionScope.dateNow) > 0 && l.dateDebutEncheres.compareTo(sessionScope.dateNow) <= 0 ) ||
                                 (sessionScope.VentesNonDebutees    != null && l.dateDebutEncheres.compareTo(sessionScope.dateNow) > 0 ) ||
                                 (sessionScope.VentesTerminees      != null && l.dateFinEncheres.compareTo(sessionScope.dateNow) <= 0 )  ||
                                 (sessionScope.VentesEnCours == null && sessionScope.VentesNonDebutees == null && sessionScope.VentesTerminees == null )
                                 )
                                 }">
                        <div class="card" style="width: 18rem;">
                            <img src="${pageContext.request.contextPath }${photoArticle}" class="card-img-top" alt="...">
                            <div class="card-body">
                                <a href="${pageContext.request.contextPath}/detailVente?id=${l.noArticle}" class="card-title">Nom : ${l.nomArticle}</a>
                                <p class="card-text">Prix : ${l.prixInitial}</p>
                                <p class="card-text">Fin de l'enchère : ${l.dateFinEncheres}</p>
                                <p class="card-text">Vendeur :  ${l.user.pseudo}</p>
                            </div>
                        </div>
                    </c:if>

                </c:forEach>
            </c:if>
            <c:if test="${empty articlesList || sessionScope.pseudoUser == null}">
                <h3>Pas d'encheres en cours</h3>
            </c:if>

        </c:otherwise>
    </c:choose>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa" crossorigin="anonymous"></script>
</body>

</html>